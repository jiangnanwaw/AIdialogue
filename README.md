# AI智能助手 - DeepSeek集成

这是一个集成DeepSeek API和SQL Server数据库查询的智能AI对话网页应用。

## 功能特点

- 全屏对话界面设计
- 支持通用AI问答（通过DeepSeek）
- 支持智能数据库查询
- 自动识别问题类型并路由到相应处理逻辑
- 支持多表联合查询（特来电、能科等16个表）

## 项目结构

```
.
├── index.html          # 前端页面
├── app.js             # 前端JavaScript逻辑
├── cloud.js           # LeanCloud云函数
├── server.js          # 服务器入口文件
├── package.json       # 依赖配置
└── .leancloud/        # LeanCloud配置目录
    └── config.json
```

## 部署到LeanCloud

### 前提条件

1. 已在LeanCloud创建应用
2. 已安装Node.js环境
3. 已安装LeanCloud CLI工具

### 部署步骤

1. 安装依赖：
```bash
npm install
```

2. 登录LeanCloud CLI：
```bash
lean login


3. 关联应用：
```bash
lean switch


4. 部署到LeanCloud：
```bash
lean deploy
```
# 部署到生产环境
lean deploy --prod
# 或者简写
lean deploy -P
### 本地测试

```bash
lean up
```

访问：http://localhost:3000

## 数据库配置

- 服务器：
- 数据库：
- 用户名：
- 密码：

## API配置

- DeepSeek API Key: 
- LeanCloud REST API: 

## 使用说明

### 数据库查询示例

#### 充电业务
- "今年特来电的平均充电服务费是多少？"
- "今天充电的总电量是多少？"
- "滴滴充电收入统计"
- "去年和今年的充电费用对比"

#### 高级时间查询（新增）
- "2024年第2季度充电收入" - 支持季度查询（Q1/Q2/Q3/Q4）
- "本周充电电量统计" - 支持周查询（本周/上周）
- "近7天收入汇总" - 支持相对时间（近N天/近N个月）
- "2024年充电收入同比增长率" - 支持增长率计算

#### 业务分析查询（新增）
- "2024年四方坪利润率是多少？" - 利润率 = (收入-成本)÷成本×100%
- "四方坪充电效率分析" - 充电效率 = 充电电量÷充电时长（度/小时）
- "本月充电收入环比增长" - 环比增长 = (本月-上月)÷上月×100%

#### 洗车业务
- "今年洗车收入是多少？"（自动汇总所有洗车表数据）
- "四方坪洗车收入统计"
- "快易洁洗车收入"

#### 其他业务
- "充电桩收入统计"
- "零售/售货机收入"
- "停车收入查询"
- "微信收入统计"

### 通用问答示例

- "什么是人工智能？"
- "如何学习编程？"
- 任何不涉及数据库查询的问题

## 注意事项

1. 所有查询结果会自动过滤空值和0值
2. 涉及平均值计算时，会在有数据的时间范围内计算
3. 能科表的充电时长字段会自动转换格式
4. 如果问题包含"充电"但未指定表名，会自动查询特来电和能科两个表

## 系统特性（新增）

### 智能错误处理
- **查询为空提示**：当查询结果为空时，系统会提示可能的原因
- **数据范围提示**：自动显示各表的数据时间范围，避免查询超范围
- **类型安全校验**：自动处理nvarchar字段转换，避免类型错误
- **友好错误反馈**：清晰的错误说明和解决建议

### 数据质量保障
- 自动清理字符串字段（去除空格、千分位分隔符）
- 智能数字类型检测和转换
- SQL注入防护
- 空值和异常值处理

### 错误提示示例
```
❓ 未查询到数据

可能原因：
• 查询时间范围内没有数据
• 筛选条件过于严格
• 指定的表名或地点不匹配
```

```
⚠️ 查询时间超出数据范围

特来电表的数据时间范围：2024-01-01 至 2026-01-15
您的查询时间：2020-01-01 至 2020-12-31

请调整查询时间后重试。
```

## 技术栈

- 前端：HTML5, CSS3, JavaScript
- 后端：Node.js, LeanCloud云引擎
- 数据库：SQL Server 2008 R2
- AI：DeepSeek API
- 部署：LeanCloud

## 许可证

Private
